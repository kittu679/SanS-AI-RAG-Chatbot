<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SanS AI - Sanskrit Learning Chatbot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Tiro+Devanagari+Sanskrit:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .font-sanskrit {
            font-family: 'Tiro Devanagari Sanskrit', serif;
        }
        /* Custom scrollbar for a cleaner look */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        .chat-bubble-user {
            background-color: #3b82f6; /* Blue 500 */
            color: white;
        }
        .chat-bubble-ai {
            background-color: #f1f5f9; /* Slate 100 */
            color: #1e293b; /* Slate 800 */
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 antialiased">

    <div class="flex h-screen bg-white">
        <!-- Sidebar -->
        <aside class="w-64 flex-shrink-0 bg-slate-100 border-r border-slate-200 flex flex-col transition-all duration-300 md:w-72">
            <div class="h-16 flex items-center justify-center border-b border-slate-200">
                <div class="flex items-center space-x-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-600"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"></path></svg>
                    <h1 class="text-xl font-bold text-slate-800">SanS AI</h1>
                </div>
            </div>
            <nav class="flex-1 p-4 space-y-2">
                <h2 class="px-3 text-xs font-semibold text-slate-500 uppercase tracking-wider">Knowledge Modes</h2>
                <a href="#" id="mode-gita" class="mode-button flex items-center px-3 py-2 text-sm font-medium rounded-lg bg-blue-100 text-blue-700">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
                    Bhagavad Gita
                </a>
                <a href="#" id="mode-ramayana" class="mode-button flex items-center px-3 py-2 text-sm font-medium rounded-lg text-slate-600 hover:bg-slate-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3"><path d="M20 10c0-4.4-3.6-8-8-8s-8 3.6-8 8c0 2.3.9 4.4 2.4 5.9"></path><path d="M15.6 15.6c1.5 1.5 2.4 3.6 2.4 5.9"></path><path d="M2.4 15.9c-1.5-1.5-2.4-3.6-2.4-5.9"></path><path d="M12 12c-3 0-5.6 1.7-7 4.1"></path><path d="M19 20c-1.4-2.4-4-4.1-7-4.1"></path><path d="M12 22a2.5 2.5 0 0 0 2.5-2.5c0-.9-.5-1.7-1.2-2.1"></path><path d="M12 22a2.5 2.5 0 0 1-2.5-2.5c0-.9.5-1.7 1.2-2.1"></path></svg>
                    Ramayana
                </a>
                <a href="#" id="mode-yoga" class="mode-button flex items-center px-3 py-2 text-sm font-medium rounded-lg text-slate-600 hover:bg-slate-200">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-3"><path d="M4.2 10.8A2.2 2.2 0 0 1 2 8.5c0-1.2 1-2.2 2.2-2.2c1.3 0 2.3 1 2.3 2.3c0 1.1-.9 2.1-2 2.2zM19.8 10.8A2.2 2.2 0 0 0 22 8.5c0-1.2-1-2.2-2.2-2.2c-1.3 0-2.3 1-2.3 2.3c0 1.1.9 2.1 2 2.2zM15 15.3c-1.2-.4-2.2.6-3 1.2c-.8-.6-1.8-1.6-3-1.2c-1.2.4-1.8 1.8-1.8 3.2A2.5 2.5 0 0 0 9.8 21c1.2.4 2.2-.6 3-1.2c.8.6 1.8 1.6 3 1.2c1.2-.4 1.8-1.8 1.8-3.2a2.5 2.5 0 0 0-2.6-2.5z"></path></svg>
                    Yoga Sutras
                </a>
            </nav>
            <div class="p-4 border-t border-slate-200">
                <div class="bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg p-4 text-white shadow-lg">
                    <h3 class="font-bold text-sm mb-1">Shloka of the Day</h3>
                    <p class="font-sanskrit text-lg leading-relaxed">कर्मण्येवाधिकारस्ते मा फलेषु कदाचन।</p>
                    <p class="text-xs opacity-80 mt-2">"You have a right to perform your prescribed duties, but you are not entitled to the fruits of your actions."</p>
                </div>
            </div>
        </aside>

        <!-- Main Chat Area -->
        <main class="flex-1 flex flex-col">
            <header class="h-16 flex items-center justify-between px-6 border-b border-slate-200 bg-white">
                <h2 id="chat-header" class="text-lg font-semibold text-slate-800">Bhagavad Gita Mode</h2>
                <div class="flex items-center space-x-4">
                    <button class="p-2 rounded-full hover:bg-slate-100">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
                    </button>
                </div>
            </header>
            
            <div id="chat-container" class="flex-1 overflow-y-auto p-6 space-y-6">
                <!-- Chat messages will be appended here -->
                <div class="flex items-start space-x-4">
                    <div class="w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold flex-shrink-0">AI</div>
                    <div class="flex-1">
                        <div class="chat-bubble-ai p-4 rounded-lg rounded-tl-none inline-block max-w-xl">
                            <p class="text-sm">Namaste! I am SanS AI, your guide to the profound wisdom of Sanskrit texts. How may I assist you in your learning journey today?</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Example Prompts -->
            <div class="px-6 pb-2">
                <div class="flex items-center space-x-2 overflow-x-auto pb-2">
                    <button class="example-prompt-button">"What is Dharma?"</button>
                    <button class="example-prompt-button">"Explain the concept of Karma"</button>
                    <button class="example-prompt-button">"Who is Arjuna?"</button>
                </div>
            </div>

            <!-- Input Area -->
            <div class="p-6 bg-white border-t border-slate-200">
                <div class="relative">
                    <input id="chat-input" type="text" placeholder="Ask a question in English..." class="w-full pl-4 pr-20 py-3 bg-slate-100 rounded-full border border-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                    <div class="absolute right-2 top-1/2 -translate-y-1/2 flex items-center space-x-1">
                        <button class="p-2 rounded-full hover:bg-slate-200">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line></svg>
                        </button>
                        <button id="send-button" class="bg-blue-600 text-white rounded-full p-2.5 hover:bg-blue-700 transition shadow">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // --- DOM Elements ---
        const chatContainer = document.getElementById('chat-container');
        const chatInput = document.getElementById('chat-input');
        const sendButton = document.getElementById('send-button');
        const chatHeader = document.getElementById('chat-header');
        const modeButtons = document.querySelectorAll('.mode-button');
        const examplePromptButtons = document.querySelectorAll('.example-prompt-button');

        let currentMode = 'Bhagavad Gita'; // Default mode

        // --- Event Listeners ---

        // Handle sending a message
        sendButton.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Handle mode switching
        modeButtons.forEach(button => {
            button.addEventListener('click', (e) => {
                e.preventDefault();
                const newMode = button.textContent.trim();
                switchMode(newMode, button.id);
            });
        });

        // Handle example prompt clicks
        examplePromptButtons.forEach(button => {
            button.addEventListener('click', () => {
                const promptText = button.textContent.replace(/"/g, '');
                chatInput.value = promptText;
                sendMessage();
            });
        });
        
        // --- Core Functions ---

        /**
         * Sends the user's message to the backend API and displays the response.
         */
        async function sendMessage() {
    const userMessage = chatInput.value.trim();
    if (userMessage === '') return;

    appendMessage(userMessage, 'user');
    chatInput.value = '';

    appendTypingIndicator();

    try {
        // Corrected the IP address here from 12.0.0.1 to 127.0.0.1
        const response = await fetch('http://127.0.0.1:8000/ask', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                question: userMessage,
                mode: currentMode
            }),
        });

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();

        removeTypingIndicator();
        appendMessage(data.answer, 'ai', data.source);

    } catch (error) {
        console.error("Error fetching from API:", error);
        removeTypingIndicator();
        appendMessage("Sorry, I'm having trouble connecting to my knowledge base. Please check if the backend server is running and try again.", 'ai');
    }
}

        /**
         * Appends a message to the chat container.
         * @param {string} message - The message text.
         * @param {string} sender - 'user' or 'ai'.
         * @param {string} [source] - Optional source citation for AI messages.
         */
        function appendMessage(message, sender, source) {
            const messageWrapper = document.createElement('div');
            messageWrapper.className = `flex items-start space-x-4 ${sender === 'user' ? 'justify-end' : ''}`;
            
            const avatar = document.createElement('div');
            avatar.className = `w-10 h-10 rounded-full flex items-center justify-center font-bold flex-shrink-0 ${sender === 'user' ? 'bg-indigo-500 text-white' : 'bg-blue-500 text-white'}`;
            avatar.textContent = sender === 'user' ? 'You' : 'AI';

            const messageContent = document.createElement('div');
            const bubble = document.createElement('div');
            bubble.className = `p-4 rounded-lg inline-block max-w-xl ${sender === 'user' ? 'chat-bubble-user rounded-br-none' : 'chat-bubble-ai rounded-tl-none'}`;
            
            const text = document.createElement('p');
            text.className = 'text-sm';
            text.textContent = message;
            bubble.appendChild(text);

            // Add source citation if available
            if (source) {
                const sourceElement = document.createElement('div');
                sourceElement.className = 'mt-3 pt-2 border-t border-slate-200 text-xs text-slate-500 flex items-center';
                sourceElement.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-1.5"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>
                    <span>Source: ${source}</span>
                `;
                bubble.appendChild(sourceElement);
            }
            
            // Add copy button for AI messages
            if (sender === 'ai') {
                const copyButton = document.createElement('button');
                copyButton.className = 'copy-button';
                copyButton.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg>`;
                copyButton.onclick = () => copyToClipboard(message);
                
                const bubbleContainer = document.createElement('div');
                bubbleContainer.className = 'relative group';
                bubbleContainer.appendChild(bubble);
                bubbleContainer.appendChild(copyButton);
                messageContent.appendChild(bubbleContainer);
            } else {
                 messageContent.appendChild(bubble);
            }

            if (sender === 'user') {
                messageWrapper.appendChild(messageContent);
                messageWrapper.appendChild(avatar);
            } else {
                messageWrapper.appendChild(avatar);
                messageWrapper.appendChild(messageContent);
            }
            
            chatContainer.appendChild(messageWrapper);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        /**
         * Adds a typing indicator to the chat.
         */
        function appendTypingIndicator() {
            const indicator = document.createElement('div');
            indicator.id = 'typing-indicator';
            indicator.className = 'flex items-start space-x-4';
            indicator.innerHTML = `
                <div class="w-10 h-10 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold flex-shrink-0">AI</div>
                <div class="flex-1">
                    <div class="chat-bubble-ai p-4 rounded-lg rounded-tl-none inline-block">
                        <div class="flex items-center space-x-1">
                            <div class="w-2 h-2 bg-slate-400 rounded-full animate-pulse" style="animation-delay: 0s;"></div>
                            <div class="w-2 h-2 bg-slate-400 rounded-full animate-pulse" style="animation-delay: 0.2s;"></div>
                            <div class="w-2 h-2 bg-slate-400 rounded-full animate-pulse" style="animation-delay: 0.4s;"></div>
                        </div>
                    </div>
                </div>
            `;
            chatContainer.appendChild(indicator);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        /**
         * Removes the typing indicator from the chat.
         */
        function removeTypingIndicator() {
            const indicator = document.getElementById('typing-indicator');
            if (indicator) {
                indicator.remove();
            }
        }

        /**
         * Switches the active knowledge mode.
         * @param {string} newMode - The name of the new mode.
         * @param {string} buttonId - The ID of the clicked button.
         */
        function switchMode(newMode, buttonId) {
            currentMode = newMode;
            chatHeader.textContent = `${newMode} Mode`;

            // Update button styles
            modeButtons.forEach(btn => {
                btn.classList.remove('bg-blue-100', 'text-blue-700');
                btn.classList.add('text-slate-600', 'hover:bg-slate-200');
            });
            document.getElementById(buttonId).classList.add('bg-blue-100', 'text-blue-700');
            document.getElementById(buttonId).classList.remove('text-slate-600', 'hover:bg-slate-200');

            // Clear chat and add a welcome message for the new mode
            chatContainer.innerHTML = '';
            appendMessage(`Welcome to ${newMode} mode. Please ask your questions.`, 'ai');
        }

        /**
         * Copies text to the clipboard.
         * @param {string} text - The text to copy.
         */
        function copyToClipboard(text) {
            // Using execCommand for broader browser compatibility in iFrames
            const textArea = document.createElement("textarea");
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            try {
                document.execCommand('copy');
                // Optional: Show a temporary "Copied!" message
            } catch (err) {
                console.error('Failed to copy text: ', err);
            }
            document.body.removeChild(textArea);
        }

        // Add some additional styling for the copy button
        const style = document.createElement('style');
        style.textContent = `
            .copy-button {
                position: absolute;
                top: 8px;
                right: 8px;
                padding: 4px;
                border-radius: 4px;
                background-color: rgba(255, 255, 255, 0.7);
                color: #475569;
                opacity: 0;
                transition: opacity 0.2s;
            }
            .group:hover .copy-button {
                opacity: 1;
            }
            .example-prompt-button {
                flex-shrink: 0;
                padding: 6px 12px;
                border-radius: 9999px;
                font-size: 0.875rem;
                background-color: #e2e8f0;
                color: #475569;
                transition: background-color 0.2s;
            }
            .example-prompt-button:hover {
                background-color: #cbd5e1;
            }
        `;
        document.head.appendChild(style);

    </script>
</body>
</html>
